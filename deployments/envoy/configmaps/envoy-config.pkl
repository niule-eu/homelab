import "package://pkg.pkl-lang.org/pkl-k8s/k8s@1.2.1#/K8sResource.pkl"
import "package://pkg.pkl-lang.org/pkl-k8s/k8s@1.2.1#/api/core/v1/ConfigMap.pkl"

hidden envoy_yaml : Any?

class EnvoyYaml {
  hidden envoy_yaml : Any?

  resources : Listing<K8sResource> = new {
    when (envoy_yaml != null) {
      new ConfigMap {
        metadata {
          name = "envoy-config"
        }
        data {
          ["envoy.yaml"] = 
            (new YamlRenderer {}).renderDocument(envoy_yaml)
        }
      } 
    }
  }
}

resources: Listing<K8sResource> = (new EnvoyYaml { envoy_yaml = module.envoy_yaml }).resources

output {
  value = resources
  renderer = (K8sResource.output.renderer as YamlRenderer) {
    isStream = true
  }
}